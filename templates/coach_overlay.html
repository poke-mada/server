    {% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Coached Overlay</title>
    <link rel="icon" href="{% static 'icon.ico' %}">
    <link rel="stylesheet" href="{% static 'overlay/styles.css' %}">
    <style>
        body {
            background-image: url("{% static 'overlay/coach/overlay.png' %}");
        }

        @font-face {
            font-family: 'streamer-font';
            src: url("{% static 'fonts/Segoe UI Bold Italic.ttf' %}") format('truetype');
        }

        @font-face {
            font-family: 'pokemon-font';
            src: url("{% static 'fonts/PKMN RBYGSC.ttf' %}") format('truetype');
        }

        * {
            overflow-x: hidden !important;
            overflow-y: hidden !important;
        }

        .team-container {
            display: flex;
            position: relative;
        }

        .team-container * {
            {#border: 1px solid red;#}
        }

        .pokemon-container1 {
            justify-content: center;
            flex-direction: column;
            position: absolute;
        }

        .pokemon-container2 {
            justify-content: center;
            flex-direction: column-reverse;
            position: absolute;
        }

        #death-count {
            position: absolute;
            top: 634px;
            left: 488px;
            color: purple;
            font-size: 30px;
            font-weight: bold;
            font-style: italic;
            text-align: left;
            z-index: 90;
        }

        #trainer-type {
            position: absolute;
            top: 310px;
            left: 17px;
            max-width: 65px;
            max-height: 65px;
            width: 65px;
            height: 65px;
            z-index: 90;
        }

        .pokemon-container1 .pkm-sprite {
            top: 850px;
        }

        .pokemon-container2 .pkm-sprite {
            top: 881px;
        }

        .pokemon-container1 .pkm-mote {
            top: 1016px;
        }

        .pkm-sprite {
            position: fixed;
            max-width: 149px;
            max-height: 136px;
            min-width: 149px;
            min-height: 136px;
            border-radius: 15px 0 30px 0;
        }

        #pokemon1 .pkm-sprite{
            left: 678px;
        }

        #pokemon2 .pkm-sprite{
            left: 881px;
        }

        #pokemon3 .pkm-sprite{
            left: 1087px;
        }

        #pokemon4 .pkm-sprite{
            left: 1290px;
        }

        #pokemon5 .pkm-sprite{
            left: 1492px;
        }

        #pokemon6 .pkm-sprite{
            left: 1700px;
        }

        .pkm-mote {
            font-family: 'pokemon-font', serif;
            color: white;
            font-size: 16px;
            position: fixed;
            text-align: center;
            max-width: 150px;
            min-width: 150px;
            max-height: 31px;
            min-height: 31px;
        }

        #pokemon1 .pkm-mote {
            left: 689px;
        }

        #pokemon2 .pkm-mote {
            left: 892px;
        }

        #pokemon3 .pkm-mote {
            left: 1098px;
        }

        #pokemon4 .pkm-mote {
            left: 1302px;
        }

        #pokemon5 .pkm-mote {
            left: 1508px;
        }

        #pokemon6 .pkm-mote {
            left: 1713px;
        }

        #coach-name, #trainer-name {
            font-family: 'streamer-font', "Segoe UI Semibold", serif;
            color: black;
            font-size: 30px;
            position: absolute;
        }

        #coach-name {
            left: 1660px;
            top: 539px;
            color: #F80091;
        }

        #trainer-name {
            left: 1655px;
            top: 268px;
            color: #0100FF;
        }

        #alert-overlay {
            position: absolute;
            left: 339px;
            top: 66px;
            max-width: 649px;
            min-width: 649px;
            max-height: 441px;
            min-height: 441px;
            display: grid;
            grid-template-rows: 2fr 1fr;
        }

        #alert-overlay > #card {
            max-height: 294px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #alert-overlay > #card * {
            max-height: 294px;
            display: grid;
        }

        #alert-overlay > .description {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        #alert-overlay > .description > * {
            font-family: Arial, serif;
            text-shadow: white 0 0 2px;
            font-weight: bold;
            font-size: 32px;
            display: inline-block;
            text-align: center;
        }

        #timer_light_1, #timer_light_2{
            position: absolute;
            top: 32px;
            left: 1242px;
            max-height: 43px;
            max-width: 43px;
        }

        #trainer-name {
            position: absolute;

            top: 323px;
            left: 93px;

            max-height: 34px;
            max-width: 209px;
        }

    </style>
</head>

<body>
    <img alt="" src="{% static 'overlay/coach/medallas/fondo.png' %}" class="badges-back">
    <img alt="" src="{% static 'overlay/coach/medallas/gym1.png' %}" id="gym1" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym2.png' %}" id="gym2" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym3.png' %}" id="gym3" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym4.png' %}" id="gym4" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym5.png' %}" id="gym5" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym6.png' %}" id="gym6" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym7.png' %}" id="gym7" class="badge d-none">
    <img alt="" src="{% static 'overlay/coach/medallas/gym8.png' %}" id="gym8" class="badge d-none">

    <div class="team-container">
        <div id="pokemon1" class="pokemon-container1">
            <img src="" alt="" class="pkm-sprite" width="150" height="136">
            <span class="pkm-mote"></span>
        </div>
        <div id="pokemon2" class="pokemon-container1">
            <img src="" alt="" class="pkm-sprite" width="150" height="136">
            <span class="pkm-mote"></span>
        </div>
        <div id="pokemon3" class="pokemon-container1">
            <img src="" alt="" class="pkm-sprite" width="150" height="136">
            <span class="pkm-mote"></span>
        </div>
        <div id="pokemon4" class="pokemon-container1">
            <img src="" alt="" class="pkm-sprite" width="150" height="136">
            <span class="pkm-mote"></span>
        </div>
        <div id="pokemon5" class="pokemon-container1">
            <img src="" alt="" class="pkm-sprite" width="150" height="136">
            <span class="pkm-mote"></span>
        </div>
        <div id="pokemon6" class="pokemon-container1">
            <img src="" alt="" class="pkm-sprite" width="150" height="136">
            <span class="pkm-mote"></span>
        </div>
    </div>
    {% if streamer_name == 'MaryBlog' %}
{#        <span id="trainer-name">Maryblog</span>#}
    {% endif %}
    <span id="death-count"></span>
    <img id="trainer-type" src="" alt="">

    <script src="{% static 'overlay/data_loader.js' %}"></script>
    <!--suppress JSUnresolvedReference -->
    <script type="application/javascript">
        const STATIC_TYPE_URL = `https://pokemon.paramada.ovh/static/types/{type_index}.png`;
        let server_socket = null;

        function setupWebsocket() {
            if (window.location.host.startsWith('localhost')) {
                if (debug) {
                    server_socket = new WebSocket(`ws://${window.location.host}/ws/overlay/{{ streamer_name }}`);
                } else {
                    server_socket = new WebSocket(`wss://pokemon.paramada.ovh/ws/overlay/{{ streamer_name }}`);
                }
            } else {
                server_socket = new WebSocket(`wss://${window.location.host}/ws/overlay/{{ streamer_name }}`);
            }
            server_socket.onclose = () => {
                server_socket = null;
            }

            server_socket.onopen = (ws) => {
                server_socket.send(JSON.stringify({
                    type: 'request_data',
                    streamer: '{{ streamer_name }}'
                }));
            }

            server_socket.onmessage = async (event) => {
                const message = JSON.parse(event.data);
                const data = JSON.parse(message.message);
                if (data.context === 'pokemon_data') {
                    doUpdateData(data);
                    const deathCount = document.getElementById('death-count');
                    deathCount.innerText = `x${data?.death_count ?? 0}`;
                    const trainerType = document.getElementById('trainer-type');
                    trainerType.src = STATIC_TYPE_URL.replace('{type_index}', data?.trainer_type ?? '0');
                } else if(data.context === 'timer_data') {
                    const timer_light_1 = document.getElementById('timer_light_1');
                    const timer_light_2 = document.getElementById('timer_light_2');
                    timer_light_1.className = ''
                    setTimeout(() => {
                        timer_light_1.className = 'd-none'
                        timer_light_2.className = ''
                        setTimeout(() => {
                            timer_light_2.className = 'd-none'
                        }, 3000)
                    }, data.data * 1000)
                } else {
                    doUpdateOverlayData(data)
                }
            }
        }

        setupWebsocket();
        setInterval(() => {
            if (server_socket === null) {
                window.location.reload();
            }
        }, 5000);
    </script>
</body>
</html>